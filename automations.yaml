###################
## System update ##
###################
- alias: 'Update Available Notifications'
  trigger:
  - platform: state
    entity_id: updater.updater
  action:
  - service: notify.gmail
    data:
      message: 'Update for Home Assistant is available.'

###################
## Sonos Speach ##
###################
#- alias: 'test'
#  trigger:
#  - platform: state
#    entity_id: input_boolean.morning_mode
#    state: 'on'
#  action:   
#  - service: script.turn_on
#    entity_id: script.morning_routine

####################
## Alarm & Lights ##
####################
- alias: "Change state to Home when Alarm is disarmed"
  trigger:
  - platform: state
    entity_id: alarm_control_panel.skumparp_alarm
    from: 'armed_away'
    to: 'disarmed'
  action:
    service: input_select.select_option
    data:
      entity_id: input_select.home_status
      option: Home

- alias: "Change state to Away when Alarm is armed"
  trigger:
  - platform: state
    entity_id: alarm_control_panel.skumparp_alarm
    from: 'disarmed'
    to: 'armed_away'
  action:
    service: input_select.select_option
    data:
      entity_id: input_select.home_status
      option: Away

- alias: 'Turn off lights in kids room when coming home late'
  trigger:
  - platform: state
    entity_id: input_select.home_status
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_status
        state: 'Home'
      - condition: time
        # At least one of the following is required.
        after: '20:00:00'
  action:
    service: homeassistant.turn_off
    entity_id: group.fonster_lampor_barn_rum

- alias: 'Turn off lights in bedroom when coming home late'
  trigger:
  - platform: state
    entity_id: input_select.home_status
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_status
        state: 'Home'
      - condition: time
        # At least one of the following is required.
        after: '21:00:00'
  action:
    service: homeassistant.turn_off
    entity_id: group.fonster_lampor_sovrum

- alias: 'Turn on game and tv in Sams room when home and when between 9am and 8pm.'
  trigger:
  - platform: state
    entity_id: input_select.home_status
  - platform: time
    at: '09:00:00'
  condition:
    condition: and
    conditions:
      - condition: state
        entity_id: input_select.home_status
        state: 'Home'
      - condition: time
        # At least one of the following is required.
        before: '20:00:00'
      - condition: time
        after: '08:59:00'
  action:
    service: homeassistant.turn_on
    entity_id: switch.sovrum_sam_tv_nexa_4

- alias: 'Turn off game and tv in Sams room when not home and when between 8pm and 9am.'
  trigger:
  - platform: state
    entity_id: input_select.home_status
  - platform: time
    at: '20:00:00'
  condition:
    condition: or
    conditions:
      - condition: state
        entity_id: input_select.home_status
        state: 'Away'
      - condition: and
        conditions:
          - condition: time
            after: '19:59:00'
          - condition: time
            before: '09:00:00'
  action:
    service: homeassistant.turn_off
    entity_id: switch.sovrum_sam_tv_nexa_4


############
## Lights ##
############

- alias: 'Turn off all lights if it is very late and the lights are still on'
  trigger:
  - platform: time
    at: '01:00:00'
  condition:
    condition: state
    entity_id: group.all_fonster_lampor
    state: 'on'
  action:
    - service: homeassistant.turn_off
      entity_id: group.all_fonster_lampor
    - service: notify.gmail
      data:
        message: 'Found some lights still on at 01:00 AM. Turning them off now...'

- alias: 'Turn on lights at sunset'
  trigger:
  - platform: sun
    # Possible values: sunset, sunrise
    event: sunset
    offset: "-00:45:00"
  action:
    - service: homeassistant.turn_on
      entity_id: group.all_fonster_lampor
    - service: homeassistant.turn_on
      entity_id: group.ute_belysning

- alias: 'Turn off lights at sunsrise'
  trigger:
  - platform: sun
    # Possible values: sunset, sunrise
    event: sunrise
    offset: "00:45:00"
  action:
    - service: homeassistant.turn_off
      entity_id: group.all_fonster_lampor
    - service: homeassistant.turn_off
      entity_id: group.ute_belysning

- alias: 'Turn off lights in Kids room if home'
  trigger:
    platform: time
    at: '20:00:00'
  condition:
    condition: state
    entity_id: input_select.home_status
    state: Home
  action:
    service: homeassistant.turn_off
    entity_id: group.fonster_lampor_barn_rum

- alias: 'Turn off lights in bedroom if home'
  trigger:
    platform: time
    at: '21:00:00'
  condition:
    condition: state
    entity_id: input_select.home_status
    state: Home
  action:
    service: homeassistant.turn_off
    entity_id: group.fonster_lampor_sovrum

- alias: 'Turn on bedroom lights in the morning if before sunrise'
  trigger:
  - platform: time
    at: '07:30:00'
  condition:
    condition: and
    conditions:
      - condition: sun
        before: sunrise
      - condition: time
        weekday:
        - mon
        - tue
        - wed
        - thu
        - fri
  action:
    - service: homeassistant.turn_on
      entity_id: group.fonster_lampor_barn_rum
    - service: homeassistant.turn_on
      entity_id: group.fonster_lampor_sovrum

- alias: 'Turn on lights in the morning if before sunrise'
  trigger:
  - platform: time
    at: '06:00:00'
  condition:
    condition: and
    conditions:
      - condition: sun
        before: sunrise
  action:
    - service: homeassistant.turn_on
      entity_id: group.fonster_lampor
    - service: homeassistant.turn_on
      entity_id: group.ute_belysning
